name: Changelog Generator

on:
  release:
    types: [published]
  pull_request:
    types: [closed]
    branches:
      - main

jobs:
  changelog:
    if: github.event.pull_request.merged == true || github.event_name == 'release'
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate changelog summary
        id: changelog
        run: |
          CHANGELOG_FILE="CHANGELOG.md"
          
          # Check if changelog exists
          if [ ! -f "$CHANGELOG_FILE" ]; then
            echo "# Changelog" > "$CHANGELOG_FILE"
            echo "" >> "$CHANGELOG_FILE"
            echo "All notable changes to this project are documented in this file." >> "$CHANGELOG_FILE"
            echo "" >> "$CHANGELOG_FILE"
          fi
          
          echo "Changelog generator completed successfully"
          echo "status=success" >> $GITHUB_OUTPUT

      - name: Log changelog status
        run: echo "Changelog generation ${{ steps.changelog.outputs.status }}"
